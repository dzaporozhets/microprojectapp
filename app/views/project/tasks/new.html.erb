<div class="mt-2 sm:mx-auto sm:w-full sm:max-w-2xl">
  <%= display_flash %>

  <%= content_tag :div, class: "window-block" do %>
    <%= form_with(model: [@project, @task], data: { turbo: false }) do |form| %>
      <div class="window-header bg-gray-100 dark:bg-gray-800 text-black dark:text-gray-100">
        <div class="flex-none">
          <h1 class="text-lg font-semibold text-violet-800 dark:text-violet-200">
            New task
          </h1>
        </div>

        <div class="grow mx-2">
        </div>

        <div class="inline-block flex">
          <%= link_to collapse_task_path(@project), class: 'ml-2 btn-sm', data: { turbo: true }, title: 'Back to tasks list' do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
          <% end %>
        </div>
      </div>

      <% if @task.errors.any? %>
        <div id="ar-errors-text" data-turbo-cache="false" class="p-3 mb-3 bg-gray-50 rounded-md border dark:bg-gray-700 dark:border-gray-600">
          <%= render("project/tasks/form_errors", resource: @task) %>
        </div>
      <% end %>

      <div class="p-3 md:my-3">
        <div class="mb-3">
          <%= form.label :name, class: "text-sm text-gray-600 dark:text-gray-400" %>
          <%= form.text_area :name, class: "mt-1 block base-input w-full", required: true, rows: 2 %>
        </div>

        <div class="mb-3">
          <%= form.label :description, class: "text-sm text-gray-600 dark:text-gray-400" %>
          <%= form.text_area :description, class: "block base-input mt-1 w-full resize-y", rows: 3 %>
        </div>
      </div>

      <div class="text-sm text-gray-600 dark:text-gray-400 border-t dark:border-t-gray-600 p-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <%= form.label :due_date, class: "text-sm text-gray-600 dark:text-gray-400" %>
            <%= form.date_field :due_date, class: "mt-1 block w-full base-input" %>
          </div>

          <% unless @project.personal? %>
            <div>
              <%= form.label :assigned_user_id, class: "text-sm text-gray-600 dark:text-gray-400" %>
              <%= form.collection_select :assigned_user_id, @project.team, :id, :email, { include_blank: "None" }, { class: "mt-1 block w-full base-input" } %>
            </div>
          <% end %>
        </div>
      </div>

      <% if @project.notes.any? %>
        <div class="text-sm text-gray-600 dark:text-gray-400 border-t dark:border-t-gray-600 p-3">
          <div>
            <%= form.label :note_id, class: "text-sm text-gray-600 dark:text-gray-400" %>
            <%= form.collection_select :note_id, @project.notes, :id, :title, { include_blank: "None" }, { class: "mt-1 block w-full base-input" } %>
          </div>
        </div>
      <% end %>

      <div class="text-xs text-gray-500 border-t dark:border-t-gray-600 p-3 flex justify-between">
        <%= form.submit 'Create task', class: "btn-primary" %>
      </div>
    <% end %>
  <% end %>
</div>
