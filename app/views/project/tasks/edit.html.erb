<%- task = @task %>

<div class="lg:w-2/3 mx-auto">
  <%= display_flash %>

  <div class="resource-container">
    <div class="resource-header">
      <div class="flex items-center justify-between w-full">
        <div>
          <h1 class="resource-title">Edit task</h1>
        </div>

        <div class="flex items-center space-x-2">
          <%= link_to details_project_task_path(task.project, task), data: { turbo: false }, title: 'Cancel', class: 'btn-sm' do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
          <% end %>
        </div>
      </div>
    </div>

    <%= form_with(model: [task.project, task], data: { turbo: turbo_frame_request? }) do |form| %>
      <% if task.errors.any? %>
        <div id="ar-errors-text" data-turbo-cache="false" class="p-4 mb-4 bg-red-50 border border-red-200 rounded-md dark:bg-red-900/20 dark:border-red-800">
          <%= render("project/tasks/form_errors", resource: task) %>
        </div>
      <% end %>

      <div class="divide-y divide-gray-200 dark:divide-gray-700 space-y-0">
        <div class="p-4">
          <div>
            <%= form.label :name, class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
            <%= form.text_area :name, class: "block w-full base-input", required: true, rows: 2, placeholder: "Enter task name..." %>
          </div>
        </div>

        <div class="p-4">
          <div>
            <%= form.label :description, class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
            <%= form.text_area :description, class: "block w-full base-input resize-y", rows: 5, placeholder: "Enter task description..." %>
          </div>
        </div>

        <div class="p-4">
          <div class="flex items-center">
            <%= form.label :done, class: "flex items-center text-sm text-gray-900 dark:text-gray-200" do %>
              <%= form.check_box :done, class: "w-4 h-4 checkbox mr-2" %>
              Mark task as completed
            <% end %>
          </div>
        </div>

        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <%= form.label :due_date, class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
              <%= form.date_field :due_date, class: "block w-full base-input" %>
            </div>

            <div>
              <%= form.label :assigned_user_id, class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
              <%= form.collection_select :assigned_user_id, task.project.team, :id, :email, { include_blank: "None" }, { class: "block w-full base-input" } %>
            </div>
          </div>
        </div>

        <% if @project.notes.any? %>
          <div class="p-4">
            <div>
              <%= form.label :note_id, class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
              <%= form.collection_select :note_id, task.project.notes, :id, :title, { include_blank: "None" }, { class: "block w-full base-input" } %>
            </div>
          </div>
        <% end %>

        <div class="p-4">
          <%= form.submit 'Save changes', class: theme_button_primary %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="resource-container mt-6">
    <div class="p-4">
      <div class="flex items-center justify-between">
        <div class="text-sm text-gray-600 dark:text-gray-400">
          <%= link_to last_update_text(task), changes_project_task_path(task.project, task), class: 'underline hover:text-gray-900 dark:hover:text-gray-200' %>
        </div>

        <%= button_to "Delete this task", [task.project, task], method: :delete, data: { turbo_confirm: 'Delete the task? Are you sure?', turbo: turbo_frame_request? }, class: "btn-remove", form_class: "" %>
      </div>
    </div>
  </div>
</div>
