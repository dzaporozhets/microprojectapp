<div class="mx-auto space-y-6">
  <!-- Current Month -->
  <div class="resource-container">
    <div class="resource-header">
      <div class="flex items-center justify-between w-full">
        <div>
          <h2 class="resource-title"><%= @date.strftime("%Y") %></h2>
        </div>
      </div>
    </div>

    <div class="p-4">
      <!-- Calendar Legend and Navigation -->
      <div class="mb-4 pb-3 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <!-- Calendar Legend -->
          <div class="flex flex-wrap items-center gap-4 text-xs text-gray-600 dark:text-gray-400">
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded-full ring-2 ring-red-300 dark:ring-red-500 bg-white dark:bg-gray-800"></div>
              <span>Today</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded-full <%= theme_bg %>"></div>
              <span>Has Tasks</span>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="flex items-center gap-2">
            <%= link_to schedule_path(date: @date.prev_month), class: "border rounded-full dark:border-gray-600 prev-month flex items-center justify-center p-2 text-gray-400 hover:text-gray-500" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            <% end %>
            <%= link_to schedule_path(date: @date.next_month), class: "border rounded-full dark:border-gray-600 next-month flex items-center justify-center p-2 text-gray-400 hover:text-gray-500" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Calendar Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Current Month Calendar -->
        <div class="calendar-month">
          <%= render_calendar_month(@date, @daily_task_counts, params[:date]) %>
        </div>

        <!-- Next Month Calendar -->
        <div class="calendar-month">
          <%= render_calendar_month(@date.next_month, @daily_task_counts, params[:date]) %>
        </div>

        <!-- Month After Next Calendar -->
        <div class="calendar-month">
          <%= render_calendar_month(@date.next_month.next_month, @daily_task_counts, params[:date]) %>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Month Tasks -->
  <div class="resource-container">
    <div class="resource-header">
      <div class="flex items-center justify-between w-full">
        <div>
          <h2 class="resource-title"><%= @date.strftime("%B") %></h2>
        </div>
      </div>
    </div>

    <div>
      <% current_month_tasks = @monthly_tasks.select { |task| task.due_date && task.due_date.month == @date.month && task.due_date >= Date.current } %>
      <% if current_month_tasks.any? %>
        <ol class="text-sm leading-6 text-gray-500 tasks-list">
          <% current_month_tasks.each do |task| %>
            <%= render 'schedule/task', task: task %>
          <% end %>
        </ol>
      <% else %>
        <div class="resource-empty-state">
          <div class="flex items-center justify-center h-12 w-12 rounded-md bg-gray-100 dark:bg-gray-800 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            No tasks due this month
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Next Month Tasks -->
  <div class="resource-container">
    <div class="resource-header">
      <div class="flex items-center justify-between w-full">
        <div>
          <h2 class="resource-title"><%= @date.next_month.strftime("%B") %></h2>
        </div>
      </div>
    </div>

    <div>
      <% next_month_tasks = @monthly_tasks.select { |task| task.due_date && task.due_date.month == @date.next_month.month } %>
      <% if next_month_tasks.any? %>
        <ol class="text-sm leading-6 text-gray-500 tasks-list">
          <% next_month_tasks.each do |task| %>
            <%= render 'schedule/task', task: task %>
          <% end %>
        </ol>
      <% else %>
        <div class="resource-empty-state">
          <div class="flex items-center justify-center h-12 w-12 rounded-md bg-gray-100 dark:bg-gray-800 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            No tasks due next month
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Month After Next Tasks -->
  <div class="resource-container">
    <div class="resource-header">
      <div class="flex items-center justify-between w-full">
        <div>
          <h2 class="resource-title"><%= @date.next_month.next_month.strftime("%B") %></h2>
        </div>
      </div>
    </div>

    <div>
      <% month_after_next_tasks = @monthly_tasks.select { |task| task.due_date && task.due_date.month == @date.next_month.next_month.month } %>
      <% if month_after_next_tasks.any? %>
        <ol class="text-sm leading-6 text-gray-500 tasks-list">
          <% month_after_next_tasks.each do |task| %>
            <%= render 'schedule/task', task: task %>
          <% end %>
        </ol>
      <% else %>
        <div class="resource-empty-state">
          <div class="flex items-center justify-center h-12 w-12 rounded-md bg-gray-100 dark:bg-gray-800 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            No tasks due <%= @date.next_month.next_month.strftime("%B") %>
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>
