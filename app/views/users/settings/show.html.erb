<% content_for :subnav do %>
  <div class="<%= subnav_css %>">
    <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-md px-4">
      <%= users_tabs 'Settings' %>
    </div>
  </div>
<% end %>

<%= display_flash %>

<div class="">
  <div class="resource-container">
    <div class="resource-header">
      <div>
        <h1 class="resource-title">Settings</h1>
        <p class="resource-description">Manage your account preferences, privacy settings, and appearance.</p>
      </div>
    </div>

    <div class="p-4">
      <%= form_for(@user, url: users_settings_path, html: { method: :put }, data: { turbo: false }) do |f| %>
        <%= render "shared/errors", resource: @user %>

        <section class="mb-8">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Privacy and Security</h2>

          <div class="space-y-4">
            <div class="flex items-center">
              <%= f.check_box :allow_invites, class: 'checkbox' %>
              <%= f.label :allow_invites, "Allow other users to add you to projects", class: 'ml-2 text-sm text-gray-700 dark:text-gray-300' %>
            </div>

            <% unless current_user.oauth_user? %>
              <div class="flex items-center">
                <%= f.check_box :otp_required_for_login, class: 'checkbox' %>
                <%= f.label :otp_required_for_login, "Enable Two-Factor Authentication", class: 'ml-2 text-sm text-gray-700 dark:text-gray-300' %>
              </div>
            <% end %>
          </div>
        </section>

        <section class="mb-8">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Appearance</h2>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Choose your preferred dark mode setting</p>

          <div class="space-y-4 mb-6">
            <div class="flex items-center">
              <%= f.radio_button :dark_mode, :on, class: "h-4 w-4 radio" %>
              <%= f.label :dark_mode_on, "Light", class: "ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200" %>
            </div>

            <div class="flex items-center">
              <%= f.radio_button :dark_mode, :off, class: "h-4 w-4 radio" %>
              <%= f.label :dark_mode_off, "Dark", class: "ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200" %>
            </div>

            <div class="flex items-center">
              <%= f.radio_button :dark_mode, :auto, class: "h-4 w-4 radio" %>
              <%= f.label :dark_mode_auto, "Auto", class: "ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200" %>
            </div>
          </div>

          <div>
            <%= f.label :theme, "Theme", class: "block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2" %>
            <%= f.select :theme,
              User.available_themes.map { |id, name| [name, id] }, {},
              class: "block w-full base-input" %>
          </div>
        </section>

        <section class="mb-4">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Avatar</h2>

          <div class="flex items-center justify-between space-x-4">
            <!-- File Upload -->
            <div class="flex-grow">
              <%= f.file_field :avatar,
                accept: allowed_img_file_types,
                class: "appearance-none file-select text-sm leading-tight file:mr-3 file:py-2 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-medium w-full" %>
            </div>

            <!-- Avatar Preview -->
            <div class="flex-shrink-0">
              <% if @user.img_url.present? %>
                <%= image_tag @user.img_url, alt: "Current Avatar", class: "w-10 h-10 rounded-full object-cover" %>
              <% end %>
            </div>
          </div>
        </section>

        <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
          <%= f.submit "Save Settings", class: theme_button_primary %>
        </div>
      <% end %>
    </div>
  </div>
</div>
